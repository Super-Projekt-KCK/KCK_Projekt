<!DOCTYPE html>
<html>
<head lang="pl">
    <meta charset="UTF-8">
    <title>Intelligent taxi</title>
    <link rel="Stylesheet" type="text/css" href="style.css" />
    <script src="graf.js">
    </script>
    <script src="analyser.js">
    </script>
    <script src="graphics.js">
    </script>
    <script src="astar.js">
    </script>
    <script type="text/javascript" src="pathfinding-browser.min.js">
    </script>
    <script type="text/javascript" src="taxi.js">
    </script>
    <script type="text/javascript" src="move_by_direction.js">
    </script>

    <script type="text/javascript" src="action.js">
    </script>
    <script type="text/javascript" src="streets.js">

    </script>
</head>

<body>
  
  <div id="world">
    <canvas id="town"width="1000px" height="1000px;"></canvas>
    <canvas id="graph" width="200px" height="200px" style="display: none;"></canvas>
    <button type="button" onclick ="initWorld();">Generate graph</button>

    <p id="array"></p>
    <p id="coords"></p>
    <div id="map" style="display: none;"></div>
    <div id="roads"></div><br />

    <div id="check"></div><br />

</div>

<div id="status">
</div>

<div id="results">
    <span id="final_span" style="color:black"></span>
    <span id="interim_span" style="color:gray"></span>
</div>
<br>Jeśli komenda zaczyna się od 'Agent' polecenie zostaje wykonane<br>
Narazie działa tylko dla kierunków wraz z synonimami np. Agent move left then right then go back<br>
<textarea id="kolejka"></textarea>
<textarea id="taxiMan"></textarea>
<button type="button" onclick="setInterval(action, 5000), taxiManStart()">start</button>
<button onclick="microphoneButton()" style="border: 0; background-color:transparent">
    <img id="status_img" src="mic.gif" alt="Start"></button>
<div id="div_language">
    <select id="select_language" onchange="updateCountry()"></select>
    <select id="select_dialect"></select>
</div>
  <input type="text" id="tescik">
  <button onClick="test()">Maciej</button>
<script src="nlp.min.js"> </script>
</body>

<script src="webspeech.js"></script>
<script>
function test(){
    var rozkaz =document.getElementById('tescik').value;

    if (rozkaz != '') {
        var res = rozkaz.split(" ");
        if(res[0] == 'Agent' || res[0] == 'agent'){
            delete res[0];
            res=String(res).replace(/,/g,' ');
            console.log(res);
            textParsing(res);
            splits();
            document.getElementById('kolejka').value='';
            queue.forEach(function (entry) {
                if(entry['action']){
                    document.getElementById('kolejka').value+=entry['action']+' ';
					if(entry['directions'] != ''){
						document.getElementById('kolejka').value+=entry['directions']+' ';
					}
					if(entry['throughdestinations'] != ''){
					var tab=entry['throughdestinations'];
					tab=tab.split(',');
					if(tab[0]=='to'){
						tab=tab.toString().replace(/,/g,' ');
						tab=tab.replace(/through/g,';through');
						tab=tab.split(';');
					}else if(tab[0]=='through'){
						tab=tab.toString().replace(/,/g,' ');
						tab=tab.toString().replace(/to/g,';to');
						tab=tab.split(';');
					} 
					var to, through;
					var and=false;
					tab.forEach(function (entry) {
						if(entry.indexOf('to') != -1){
						  to=entry.split(' '); 
							to.splice(0, 1);
							to.forEach(function (en) {
								and = to.indexOf('and');
								if(and != false){
									to.splice(and, 1);
								}
								and=false;
							});
						}else if(entry.indexOf('through') != -1){
							through=entry.split(' ');
							through.splice(0, 1);
							through.forEach(function (en) {
								and = through.indexOf('and');
								if(and != false){
									through.splice(and, 1);
                                    alert(and);
								}
								and=false;
							});
						}
					});
					document.getElementById('kolejka').value+= ' do '+to+' ';
                    document.getElementById('kolejka').value+= ' przez '+through+'\n';
					}
                }
            });

        }else{
            document.getElementById('kolejka').value='nie wykona polecenia';
        }
}
}
	
	
    var reco = new WebSpeechRecognition();
    reco.statusText('status');
    reco.statusImage('status_img');
    reco.finalResults('final_span');

    reco.continuous = false;

    reco.onEnd = function() {
        if (reco.final_transcript != '') {
            var res = reco.final_transcript.split(" ");
            if(res[0] == 'Agent' || res[0] == 'agent'){
                delete res[0];
                res=String(res).replace(/,/g,' ');
                console.log(res);
                textParsing(res);
                splits();
                document.getElementById('kolejka').value='';
                queue.forEach(function (entry) {
                    if(entry['action']){
                        document.getElementById('kolejka').value+=entry['action']+' ';
                        document.getElementById('kolejka').value+=entry['direction']+' ';
                        document.getElementById('kolejka').value+=entry['destination']+' ';
                        document.getElementById('kolejka').value+=entry['through']+' ';
                        document.getElementById('kolejka').value+=entry['through']+'\n';
                    }
                });

            }else{
                document.getElementById('kolejka').value='nie wykona polecenia';
            }

            microphoneButton();
        }
    };
    // Handler when user clicks microphone button.
    function microphoneButton() {
        reco.lang = select_dialect.value;
        reco.toggleStartStop();
    }


    var langs =
            [['English',         ['en-AU', 'Australia'],
                    ['en-CA', 'Canada'],
                    ['en-IN', 'India'],
                    ['en-NZ', 'New Zealand'],
                    ['en-ZA', 'South Africa'],
                    ['en-GB', 'United Kingdom'],
                    ['en-US', 'United States']]
];

    function updateCountry() {
        for (var i = select_dialect.options.length - 1; i >= 0; i--) {
            select_dialect.remove(i);
        }
        var list = langs[select_language.selectedIndex];
        for (var i = 1; i < list.length; i++) {
            select_dialect.options.add(new Option(list[i][1], list[i][0]));
        }
        select_dialect.style.visibility = list[1].length == 1 ? 'hidden' : 'visible';
    }

    for (var i = 0; i < langs.length; i++) {
        select_language.options[i] = new Option(langs[i][0], i);
    }
    select_language.selectedIndex = 0;
    updateCountry();
    select_dialect.selectedIndex = 6;
</script>

<br><button onclick="speak(/Can't move in this direction/)">Przykładowy komunikat głosowy</button>

</html>
